# ADR.003

Выбор класса системы хранения комментариев

<!-- Название ADR состоит из [ADR.###] [Коротко суть принятого решения] -->

* Статус: Предложено
* Владелец: mekuleshov@mts.ru

## Контекст
<!-- Описание проблемы, требующей решения, причин, побудивших принять решение, ограничений, действовавших на момент принятия решения -->
Необходимо проанализировать, какой из типов хранилища данных больше подходит для данных комментариев к докладам и конференцями 

## Варианты решения
<!-- Описание рассмотренных вариантов c их плюсами и минусами -->

### Традиционная ACID реляционная СУБД - PostgreSQL
<!-- Описание варианта 1 -->
* **Плюсы**
  * Не требуется дополнительная логика для организации консистентности данных бизнес уровня - выделение транзакций автоматически решает эту задачу
  * Больший опыт использования в команде - выше скорость разработки
  * Единый стандарт базы для всех микросервисов проекта
* **Минусы**
  * Более сложный вариант горизонтального масштабирования
  * Изменения в модели данных требуют большей внимательности и процедур миграции данных
  * Масштабирование - только вертикальное

### Нереляционная БД BASE на основе MongoDB - вариант CA
<!-- Описание варианта 2 -->
* **Плюсы**
  * Поддержка горизонтального машстабирования при увеличинии нагрузки на сервис
  * Более гибкий подход к управлению моделью
  * Поддержка ссылок для документов в колекции
* **Минусы**
  * База жертвует доступностью для обеспечения консистентности, что для данной категории бизнес сущности - менее желательно
  
### Нереляционная БД BASE на основе CassandraDB - вариант AP

* **Плюсы**
  * Поддержка горизонтального машстабирования при увеличинии нагрузки на сервис
  * Нет единой точки отказа (в отличии от других вариантов)
  * База оптимизирована на операции записи больше, чем на операции чтения
* **Минусы**
  * Повышенный порог вхождения для данной технологии

## Решение
<!-- Описание выбранного решения. Решение должно быть сформулировано чётко ("Мы используем...", "Мы не используем", а не "Желательно.." или "Предлагается..."). 
Должна быть понятна связь между решением и проблемой, почему выбрали именно это решение из вариантов -->

В проекте helloconf мы используем базу cassandra для микросервиса работы с комментариями. Исходим из того, что количество регистраций пользователей может достигать 100k на одну конференцих (QR.005), а каждый пользователь может написать много комментариев, плюс комметарии могут объединятся в цепочки обсуждений.
В рамках ADR было проведено внутреннее тестирование, которое показало, что загрузка подобного рода данных выполняется быстрее на NoSQL базе.

Комментарии не являются критической бизнес-сущностью, поэтому мы может пожертвовать консистентностью (Consistency) в ущерб доступности.

Комметарии являются достаточно простой структурой данных, поэтому использование слабо структурированного хранилища не несет негативных последствий.

Работа с комментариями не подразумевает наличие сложных связанных бизнес-транзакций

## Последствия
<!-- Положительные и отрицательные последствия (trade-offs). Арх. решения, которые потребуется принять как следствие принятого решения. Если решение содержит риски, то описано, как с ними планируют поступить (за счет чего снижать, почему принять). -->

Не все участники разработки имеют достаточный опыт с CassandraDB. Требуется менторинг со стороны проектного архитектора по валидации используемых паттернов работы с новой БД.